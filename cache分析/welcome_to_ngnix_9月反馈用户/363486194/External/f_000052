(function(e,a){var d=e.qservice||(e.qservice={}),c=function(){},j=function(f,b,g){if(g==a)g=true;for(var q in b)if(!(q in f)||g)f[q]=b[q];return f},k=function(f){if(typeof f=="string")return f;var b=[],g;for(g in f)b.push(encodeURIComponent(""+g)+"="+encodeURIComponent(""+f[g]));return b.join("&")},o=function(f){var b=document.createElement("a");b.href=f;return b.hostname},i=function(f){var b={method:"GET",data:{},onSuccess:c,onError:c,type:"json",context:null};if(typeof f=="object")j(b,f);else typeof f==
"function"&&j(b,{onSuccess:f});var g=b.onSuccess,q=b.context;b.onSuccess=function(n){var r=n.responseText;if(b.type==="json")try{r=JSON.parse(r);r.arguments=n.arguments}catch(t){}g.call(q,r)};b.method=b.method.toUpperCase();if(b.method==="GET"){b.contentType=b.contentType||"text/plain;charset=UTF-8";f=+new Date;b.data.t=f-(b.cacheTime?f%b.cacheTime:0)}else if(f.method==="POST")b.contentType=b.contentType||"application/x-www-form-urlencoded;charset=UTF-8";b.data=k(b.data);return b},m={},p=function(f,
b,g){if(m[g])m[g](f,b);else{var q=o(g).replace(/\./g,"_"),n=document.getElementById("$ifm_"+q);if(!n){n=document.createElement("iframe");n.src=g;n.id="$ifm_"+q;n.style.display="none";document.body.appendChild(n)}var r,t=function(){if(n.contentWindow.ajax){clearTimeout(r);m[g]=n.contentWindow.ajax;m[g](f,b)}else r=setTimeout(t,16)};t()}},u=function(f,b){var g,q=false,n=false;f=f||"";var r=b.arguments||null,t=b.onSuccess||c,A=b.onError||c,x=b.onComplete||c,y=b.onTimeout||c,z=b.isAsync===false?false:
true,B=b.timeout===0?0:b.timeout||3E4;g=new XMLHttpRequest;g.withCredentials=true;g.onreadystatechange=function(){if(g.readyState==4){if(!q){var v={arguments:r},D;a:{var C=g;try{D=!C.status&&location.protocol=="file:"||C.status>=200&&C.status<300||C.status==304||navigator.userAgent.indexOf("Safari")>-1&&typeof C.status=="undefined";break a}catch(E){}D=false}if(D){v.responseText=g.responseText;t(v)}else A(v);x(v)}n=true;g=null}};g.open(b.method,f,z);g.setRequestHeader("Content-Type",b.contentType);
g.send(b.data);B&&setTimeout(function(){var v;if(!n){q=true;if(g){g.abort();g=null}v={arguments:r};y(v);x(v)}},B)};d.proxySend=function(f,b,g){b=i(b);if(b.method==="GET"){f+=(f.indexOf("?")===-1?"?":"&")+b.data;b.data=null}g=g||"http://"+o(f)+"/proxy.html";p(f,b,g)};d.xdomainSend=function(f,b){b=i(b);if(b.method==="GET"){f+=(f.indexOf("?")===-1?"?":"&")+b.data;b.data=null}u(f,b)}})(window);
(function(e,a){var d=window[e]||(window[e]={}),c={utils:{halt:function(){}}},j=function(){},k=function(i,m){var p=function(){if(this instanceof arguments.callee)this.__init__&&this.__init__.apply(this,arguments);else throw Error("You must new an instance");};if(m){p.prototype=new m;for(var u in i)if(i.hasOwnProperty(u)){if(u=="__init__"){var f=p.prototype.__init__,b=i[u];if(f){p.prototype.__init__=function(){f.apply(this,arguments);b.apply(this,arguments)};continue}}p.prototype[u]=i[u]}}else p.prototype=
i;return p},o=k({send:function(){throw Error("This method should be rewrite!");}});k=k({__init__:function(i){i=i||{};this._initOption(i);i=this.size;this.len=i-1;this.array=[];this.array[i-1]=a;this.errors=this.pointer=0},_initOption:function(i){this.size=i.size||20;this.timeout=i.timeout||3;this.errorMax=i.errormax||10},send:function(i){for(var m=this.pointer,p=0,u=this.len,f=this.array;p<=u;p++){m=m+1>u?m-u:m+1;c.utils.halt("check if "+m+" is free.");if(this._isFree(f[m],m)){this.pointer=m;this._send(i,
m);c.utils.halt(m+" is free!");break}}},_onError:function(){this.errors++;if(this.errors>=this.errorMax){this.send=j;c.utils.halt("stop report")}},_isFree:function(i,m){if(i&&"ts"in i&&+new Date-i.ts<this.timeout*1E3)return false;else if(i&&"ts"in i){if(!i.finish){this._onError();this._setFree(m);c.utils.halt("report time out!");return false}return true}return true},_setFree:function(i){this.array[i].finish=true},release:function(){return window.CollectGarbage?window.CollectGarbage:function(){}}(),
_send:function(i){var m=this.array[this.pointer];if(!(m&&"ts"in m)){m=this.array[this.pointer]={};m.dom=new Image;m.dom.onload=function(){m.finish=true};m.dom.onerror=function(){m.finish=true}}m.ts=+new Date;m.dom.src=i+"&t="+m.ts;m.finish=false}},o);d.tracker={Img:new k}})("tc");
Jx().$package("tc.pref",function(){var e=(new Date).getTime();this.init=function(){window.onload=function(){a(7723,1,14,14)}};this.report=function(d){var c=(new Date).getTime(),j="http://isdspeed.qq.com/cgi-bin/r.cgi?flag1=7723&flag2=1&flag3=15&"+(d=="cgi"?1:2)+"="+(c-e),k=new Image;setTimeout(function(){k.src=j},0)};var a=function(d,c,j,k){var o=window.msPerformanc||window.webkitPerformance||window.performance,i=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd",
"fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],m=[];j=j;if(o&&(_timeline=o.timing)){if(typeof _timeline.msFirstPaint!="undefined")i.push("msFirstPaint");else if(k)j=k;k=_timeline[i[0]];for(var p=1,u=i.length;p<u;p++){o=(o=_timeline[i[p]])?o-k:0;o>0&&m.push(p+"="+o)}var f="http://isdspeed.qq.com/cgi-bin/r.cgi?flag1="+
d+"&flag2="+c+"&flag3="+j+"&"+m.join("&"),b=new Image;setTimeout(function(){b.src=f},0)}};this.init()});
Jx().$package("tc.ctrl",function(e){this.bindCommand=function(a,d,c){if(arguments.length===1){c=a;a=document.body;d="click"}else if(arguments.length===2){c=d;d="click"}if(a._commends)e.extend(a._commends,c);else{a._commends=c;a.getAttribute("cmd")||a.setAttribute("cmd","void");e.event.on(a,d,function(j){var k=tc.util.getActionTarget(j,-1,"cmd",this);if(k){var o=k.getAttribute("cmd"),i=k.getAttribute("param");k.href&&k.getAttribute("href").indexOf("#")===0&&j.preventDefault();this._commends[o]&&this._commends[o](i,
k,j)}})}};this.hasApi=function(a){return"function"===typeof external[a]?true:false};this.callApi=function(a){for(var d=Array.prototype.slice.call(arguments,1),c=0,j=d.length;c<j;c++)if(e.isObject(d[c]))d[c]=JSON.stringify(d[c]);if("function"===typeof external[a])try{external[a].apply(window,d)}catch(k){}}});
Jx().$package("tc.net",function(e){this.getStrangerSimpleInfo=function(d,c){qservice.xdomainSend("http://cgi.qqweb.qq.com/tempchatforgroup/api/get_single_info",{data:d,onSuccess:c,onError:c,onTimeout:c})};this.getFeeds=function(d,c){qservice.xdomainSend("http://cgi.qqweb.qq.com/tempchatforgroup/qzone/get_feeds",{data:d,onSuccess:c,onError:c,onTimeout:c})};var a=function(){var d=0;return function(){return d++}}();this.getGDTList=function(d,c){var j="_gdtcb"+a();window[j]=function(o){delete window[j];
c(o)};d.callback=j;var k={query:e.string.toQueryString(d),charset:"gbk"};e.http.loadScript("http://q.i.gdt.qq.com/gdt_view.fcg",k)};this.report2GDT=function(d){tc.tracker.Img.send(d)};this.report2Client=function(d){tc.ctrl.callApi("ClientDataReport",d)}});
Jx().$package("tc.util",function(e){this.getActionTarget=function(a,d,c,j){a=a.target;var k=d||3;d=d!==-1;c=c||"cmd";for(j=j||document.body;a&&a!==j&&(d?k-- >0:true);)if(a.getAttribute(c))return a;else a=a.parentNode;return null};this.getLevelHtml=function(a){a=tc.util.toNumber(a);if(!a)return'<span class="level" style="width:18px;background-position:0 -72px;"></span>';for(var d=0,c="",j=[a>>6,a>>4&3,a>>2&3,a&3],k=0,o;a;k++){o=j[k];a-=o;if(o+d>9||o+d===9&&a>0){if(o=8-d)c+='<span class="level" style="width:'+
18*o+"px;background-position:0 "+k*-18+'px;"></span>';c+='<span class="level" style="width:18px;background-position:0 -72px;"></span>';break}if(o)c+='<span class="level" style="width:'+18*o+"px;background-position:0 "+k*-18+'px;"></span>';d+=o}return c};this.getQuery=function(a){a=a.split("&");var d={},c;for(c in a){var j=a[c].split("=");d[j[0]]=j[1]}return d};this.toNumber=function(a){return isFinite(a)?Number(a):0};this.getHoroscopes=function(a){if(a==0)return" -";switch(a){case 1:return"\u6c34\u74f6\u5ea7";
case 2:return"\u53cc\u9c7c\u5ea7";case 3:return"\u767d\u7f8a\u5ea7";case 4:return"\u91d1\u725b\u5ea7";case 5:return"\u53cc\u5b50\u5ea7";case 6:return"\u5de8\u87f9\u5ea7";case 7:return"\u72ee\u5b50\u5ea7";case 8:return"\u5904\u5973\u5ea7";case 9:return"\u5929\u79e4\u5ea7";case 10:return"\u5929\u874e\u5ea7";case 11:return"\u5c04\u624b\u5ea7";case 12:return"\u6469\u7faf\u5ea7"}};this.convertRange=function(a){a=tc.util.toNumber(a);return a<=0?"\u5f88\u591a":a>=1E8?"&gt;"+Math.floor(a/1E8)+"\u4ebf":a>=
1E7?"&gt;"+Math.floor(a/1E7)+"\u5343\u4e07":a>=1E6?"&gt;"+Math.floor(a/1E6)+"\u767e\u4e07":a>=1E5?"&gt;"+Math.floor(a/1E5)+"\u4e07":a};this.convertBirthday=function(a,d,c){var j=tc.util.toNumber;a=j(a);d=j(d);c=j(c);if(d&&c)return(a?a:"")+"."+d+"."+c;return""};this.formatData=function(a){var d=new Date(a*1E3);a=d.getFullYear();var c=d.getMonth()+1;d=d.getDate();c=c<10?"0"+c:c;d=d<10?"0"+d:d;return a+"-"+c+"-"+d};this.loadImg=function(a,d){var c=new Image;c.src=d;c.onload=function(){var j=e.dom.id("uid"+
a);e.dom.setStyle(j,"marginLeft",(85-c.width)/2+"px");e.dom.setStyle(j,"marginTop",(65-c.height)/2+"px");j.src=d}}});
Jx().$package("tc.gdt",function(e){var a=this,d,c,j,k,o,i,m,p=false,u=false,f,b,g,q,n,r,t=0,A=0,x,y,z;this.init=function(h){c=h.sext;j=h.stkey;d=h.tuin;k=h.noAd;h=e.dom.id("gdtBlock");tc.ctrl.bindCommand(h,{switchGDT:function(l,s,w){var F=s.getAttribute("ping");s=s.getAttribute("href");F&&tc.net.report2GDT(decodeURIComponent(F));if(tc.ctrl.hasApi("OpenAdUrl")){w.preventDefault();u?tc.ctrl.callApi("OpenAdUrl",s+"&clk=$KEY$&cln=$UIN$"):tc.ctrl.callApi("OpenAdUrl","http://ptlogin2.qq.com/jump?clientuin=$UIN$&clientkey=$KEY$&u1="+
s+"&jtype=0")}tc.gdt.switchGDT();if(l=="img")tc.net.report2Client("image");else l=="txt"&&tc.net.report2Client("link")}});e.event.on(h,"mouseenter",function(){a.pause("switchGDT");a.pause("reqinterval")});e.event.on(h,"mouseleave",function(){a.start("switchGDT");a.start("reqinterval")});i=0;a.request()};this.request=function(){if(!p){p=true;var h={req:{friendqq:d,uintype:k?1:0},pos:{"0":{}}};i||(m=Date.now());var l=2;if(c==""){c=encodeURIComponent(window.btoa(JSON.stringify(h)));l=1}h={adposcount:1,
posid:"288231497961166031",freshinfo:o?JSON.stringify(o):"",reqcount:i,delaytime:Math.round((Date.now()-m)/1E3),uin:e.cookie.get("uin").replace(/^[oO0]*/,""),sext:c,stkey:j,encid:l};if(j=="")h.skey=e.cookie.get("skey");tc.net.getGDTList(h,B)}};this.onMsg=function(){if(g==3)if(!(A++<n-1&&n!=1)){A=0;a.switchGDT()}};this.onFocus=function(){g==4&&a.switchGDT()};this.switchGDT=function(){if(!p){p=true;if(f&&f.length){b=++b%f.length;if(b==0&&t<r)t++;else if(b==0&&r>0&&r==t){t=0;p=false;a.request();return}var h=
f[b],l=new Image;l.onload=function(){var s=e.dom.id("gdtBlock"),w=e.extend({html:e.string.encodeHtmlSimple,attr:e.string.encodeHtmlAttributeSimple,range:tc.util.convertRange},h);s.innerHTML=e.string.template("gdtTmpl")(w);p=false;if(y)D(h.apurl);else if(x==0&&!h.reported){tc.net.report2GDT(h.apurl);h.reported=true}else if(x==1&&!z){h.showed=true;if(b==f.length-1){C(f);z=true}}if(h.apptrace){tc.net.report2GDT(h.apptrace);h.apptrace=null}f.length>1&&q&&g==2&&a.delay("switchGDT",a.switchGDT,q);tc.net.report2Client("show")};
l.onerror=function(){p=false;if(x==1&&!z&&b==f.length-1){C(f);z=true}f.length>1&&q&&a.delay("switchGDT",a.switchGDT,q)};l.src=h.img}}};var B=function(h){tc.pref.report("gdt");p=false;var l=h.reqinterval&&h.reqinterval*1E3||3E5;if(h.ret===0){var s=h&&h.data&&h.data["288231497961166031"]||0,w=s.cfg&&s.cfg.playcfg||0;i=0;o=h.freshinfo;f=s.list||f;n=w.pollcondmsgnum||1;r=w.pollcommcyclenum;g=w.displaymode;a.displaymode=w.displaymode;q=(w.displayinterval||0)*1E3;x=w.instancerpt;y=(w.timingrpt||0)*60*1E3;
u=w.nojumppt||0;z=false;if(f){b=-1;a.switchGDT()}l&&g==2&&a.delay("reqinterval",a.request,l);y?a.delay("sendReportTag",E,y):a.clear("sendReportTag",E,y)}else if(h.ret===99){i++;a.delay("reqinterval",a.request,l||3E5)}else if(i<5){i++;a.delay("reqinterval",a.request,3E5)}},v={},D=function(h){if(h=h&&(h.match(/\bviewid=([^&#]+)/)||0)[1])if(h in v)v[h]++;else v[h]=1},C=function(h){v={};for(var l=0,s=h.length;l<s;l++)h[l].showed&&D(h[l].apurl);E()},E=function(){var h=0,l="",s;for(s in v){l+="&viewid"+
h+"="+s;if(v[s]>1)l+="&count"+h+"="+v[s];h++}h&&tc.net.report2GDT("http://v.gdt.qq.com/gdt_stats.fcg?count="+h+l);v={};y&&a.delay("sendReportTag",E,y)};(function(){var h={};a.delay=function(l,s,w){a.clear(l);h[l]={callback:s,handler:setTimeout(s,w),ts:Date.now(),doration:w}};a.pause=function(l){if((l=h[l])&&l.ts){clearTimeout(l.handler);l.doration-=Date.now()-l.ts;l.ts=0}};a.start=function(l){if((l=h[l])&&!l.ts){l.handler=setTimeout(l.callback,l.doration);l.ts=Date.now()}};a.clear=function(l){var s=
h[l];if(s){clearTimeout(s.handler);h[l]=null}}})()});function clientOnmsg(){tc.gdt.onMsg()}function clientOnFocus(){tc.gdt.onFocus()}
Jx().$package("tc.main",function(e){var a=e.string.mapQuery();if(a.param)var d=tc.util.getQuery(window.atob(decodeURIComponent(a.param))),c=tc.util.toNumber(d.guin),j=tc.util.toNumber(d.gid),k=tc.util.toNumber(d.touin),o=d.noad||1;else{c=tc.util.toNumber(a.guin);j=tc.util.toNumber(a.gid);k=tc.util.toNumber(a.touin);o=a.noad=="1"}var i=a.sext||"",m=a.stkey||"",p=function(b,g){var q=e.dom.mini("li",e.dom.id("navsList")),n=["photoBlock","blogBlock","userBlock"];if(g)for(var r in n)n[r]==g?e.dom.show(e.dom.id(n[r])):
e.dom.hide(e.dom.id(n[r]));for(var t in q){n=q[t];b==n?e.dom.addClass(b,"selected"):e.dom.removeClass(n,"selected")}};this.init=function(){var b=e.dom.id("wrap");tc.net.report2Client("GFPShow");tc.ctrl.bindCommand(b,{addBuddy:function(){tc.ctrl.callApi("AddBuddy",k.toString());tc.net.report2Client("GFPAddFriend")},openGroupChat:function(g){tc.ctrl.callApi("OpenGroupChat",g)},showPhoto:function(g,q){p(q,g);tc.net.report2Client("GFPRecentPhotoTabClick")},showBlog:function(g,q){p(q,g);tc.net.report2Client("GFPRecentFeedsTabClick")},
showInfo:function(g,q){p(q,g);tc.net.report2Client("GFPRecentMoreInfoTabClick")},photoClick:function(){tc.net.report2Client("GFPRecentPhotoClick")},qzoneClick:function(){tc.net.report2Client("GFPRecentFeedsQZoneClick")}});tc.net.getStrangerSimpleInfo({tuin:k,gcode:c},f);tc.net.getFeeds({tuin:k},u);tc.gdt.init({guin:c,gid:j,sext:i,stkey:m,tuin:k,noAd:o})};var u=function(b){var g=e.dom.id("photoBlock"),q=e.dom.id("blogBlock");if(b.ret==0){var n=b.feeds,r=b.albumns,t,A=0,x=0;if(r.length>0){r=r[0];x=
r.images[0].upload_time;var y=e.extend({uin:k,load:tc.util.loadImg},r)}if(n.length>1){for(var z in n)if(n[z].ts){t=n[z];break}A=t.ts;var B=e.extend({uin:k,guin:c,html:e.string.encodeHtmlSimple,attr:e.string.encodeHtmlAttributeSimple,time:tc.util.formatData},t)}else if(n.length==1){t=n[0];A=t.ts;B=e.extend({uin:k,guin:c,html:e.string.encodeHtmlSimple,attr:e.string.encodeHtmlAttributeSimple,time:tc.util.formatData},t)}q.innerHTML=B?e.string.template("blogTmpl")(B):b.feeds_ret==1E5?'<div class="failmsg">\u5bf9\u4e0d\u8d77\uff0c\u60a8\u6682\u672a\u83b7\u5f97<br>\u8bbf\u95ee\u8be5\u7a7a\u95f4\u7684\u6743\u9650</div>':
'<div class="failmsg1">\u6682\u65e0\u6700\u65b0\u52a8\u6001\u5594~</div>';g.innerHTML=y?e.string.template("photoTmpl")(y):b.albums_ret==1E5?'<div class="failmsg">\u5bf9\u4e0d\u8d77\uff0c\u60a8\u6682\u672a\u83b7\u5f97<br>\u8bbf\u95ee\u8be5\u7a7a\u95f4\u7684\u6743\u9650~</div>':'<div class="failmsg1">\u6682\u65e0\u6700\u65b0\u52a8\u6001\u5594~</div>';b=(new Date).getTime();if(x*1E3>b-1296E6){p(e.dom.id("LastPhoto"),"photoBlock");tc.net.report2Client("GFPRecentPhotoFirstTabShow")}else if(x!=A)if(x>A){p(e.dom.id("LastPhoto"),
"photoBlock");tc.net.report2Client("GFPRecentPhotoFirstTabShow")}else{p(e.dom.id("LastFeed"),"blogBlock");tc.net.report2Client("GFPRecentFeedsFirstTabShow")}else{p(e.dom.id("MoreInfo"),"userBlock");tc.net.report2Client("GFPRecentMoreInfoFirstTabShow")}}else{q.innerHTML='<div class="failmsg1">\u6682\u65e0\u6700\u65b0\u52a8\u6001\u5594~</div>';g.innerHTML='<div class="failmsg1">\u6682\u65e0\u6700\u65b0\u52a8\u6001\u5594~</div>';p(e.dom.id("MoreInfo"),"userBlock")}},f=function(b){tc.pref.report("cgi");
var g=e.dom.id("infoBlock"),q=e.dom.id("userBlock"),n;if(b.ret===0){n=e.extend({uin:k,guin:c,level:tc.util.getLevelHtml,hors:tc.util.getHoroscopes,html:e.string.encodeHtmlSimple,attr:e.string.encodeHtmlAttributeSimple,num:tc.util.toNumber,bDay:tc.util.convertBirthday},b);b=e.extend({uin:k,guin:c,level:tc.util.getLevelHtml,hors:tc.util.getHoroscopes,html:e.string.encodeHtmlSimple,attr:e.string.encodeHtmlAttributeSimple,num:tc.util.toNumber,bDay:tc.util.convertBirthday},b);g.innerHTML=e.string.template("userInfoTmpl")(n);
q.innerHTML=e.string.template("userTmpl")(b)}else{n={uin:k,guin:c};g.innerHTML=e.string.template("failInfoTmpl")(n);q.innerHTML='<div class="failmsg1">\u4e2a\u4eba\u8d44\u6599\u52a0\u8f7d\u5931\u8d25</div>'}};this.init()});
