
(function(){var mods=[],version=parseFloat(seajs.version);define(["lib","common","$","webbase_css"],function(require,exports,module){var uri=module.uri||module.id,m=uri.split('?')[0].match(/^(.+\/)([^\/]*?)(?:\.js)?$/i),root=m&&m[1],name=m&&('./'+m[2]),i=0,len=mods.length,curr,args,undefined;for(;i<len;i++){args=mods[i];if(typeof args[0]==='string'){name===args[0]&&(curr=args[2]);args[0]=root+args[0].replace('./','');(version>1.0)&&define.apply(this,args);}}
mods=[];require.get=require;return typeof curr==='function'?curr.apply(this,arguments):require;});define.pack=function(){mods.push(arguments);(version>1.0)||define.apply(null,arguments);};})();define.pack("./access_check",["lib","common","$"],function(require,exports,module){var lib=require('lib'),common=require('common'),constants=common.get('./constants'),$=require('$'),console=lib.get('./console'),events=lib.get('./events'),url_parser=lib.get('./url_parser'),query_user=common.get('./query_user'),session_event=common.get('./global.global_event').namespace('session'),login_callback_stack=[],login_to,heartbeat,heartbeat_interval=45*60*1000,undefined;var access_check={init:function(){var me=this;if(me._ready)
return;me.listenTo(session_event,'session_timeout',function(login_callback){$.isFunction(login_callback)&&login_callback_stack.push(login_callback);query_user.destroy();me._req_ptlogin_n_quser();}).listenTo(session_event,'invalid_indep_pwd',function(login_callback,rsp_body){$.isFunction(login_callback)&&login_callback_stack.push(login_callback);me._req_indep_login(rsp_body['nickname']);});me.listenTo(query_user,'load',function(){clearTimeout(heartbeat);heartbeat=setTimeout(function(){query_user.get(true,true,false);},heartbeat_interval);});var _login_to=url_parser.get_cur_url().get_hash_param('login_to');if(_login_to&&_login_to.indexOf('http://www.weiyun.com/')===0){login_to=_login_to;}
me._ready=true;},start:function(){var me=this;me.init();if(!query_user.check_cookie()){this._req_ptlogin_n_quser();}
else{me._server_check();}},_req_ptlogin_n_quser:function(){var me=this;if(constants.IS_WRAPPED){me.trigger('external_login');}else{require.async('qq_login',function(qq_login){var qq_login_mod=qq_login.get('./qq_login');qq_login_mod.show();me.stopListening(qq_login_mod).listenTo(qq_login_mod,'qq_login_ok',function(){me._server_check();});});}},_req_indep_login:function(nickname){var me=this;require.async('indep_login',function(indep_login_mod){var indep_login=indep_login_mod.get('./indep_login');indep_login.show(nickname||'');me.stopListening(indep_login).listenTo(indep_login,'indep_login_ok',function(){me._server_check();});});},_server_check:function(){if(login_to){query_user.off('load').on('load',function(){return false;});query_user.check().done(this._server_check_callback);}else{query_user.get(true,true,true).ok(this._server_check_callback);}},_server_check_callback:function(){if(login_to){location.href=login_to;}
else{var stack=login_callback_stack;while(stack&&stack.length){var fn=stack.shift();typeof fn==='function'&&fn();}}}};$.extend(access_check,events);return access_check;});define.pack("./ad_link",["lib","common","$","./main"],function(require,exports,module){var lib=require('lib'),common=require('common'),$=require('$'),events=lib.get('./events'),user_log=common.get('./user_log'),query_user=common.get('./query_user'),constants=common.get('./constants'),center=common.get('./ui.center'),aid=common.get('./configs.aid'),urls=common.get('./urls'),closed_ad_web=false,closed_ad_appbox=false,show_phone_download=false,default_link_type='text',uin=query_user.get_uin_num(),link_options,block_uins=['10001','711029','10321','6508431','10015','10332','542245351'];var ad_link={render:function(){var me=this;if($.inArray(uin+'',block_uins)>-1){return;}
$.ajax('/data/ad_config.json',{cache:false,dataType:"json",success:function(data){link_options=data;default_link_type=data['appbox_link_type'];closed_ad_web=!data['enable_ad_web'];closed_ad_appbox=!data['enable_ad_appbox'];me._add_adtag(data);if(data['appbox_link_type']==='phone'){show_phone_download=true;default_link_type='text';data['appbox_text_text']=data['appbox_phone_text'];}else if(data['appbox_link_type']==='img'&&data['appbox_img_phone_ad']){show_phone_download=true;}
if(constants.IS_APPBOX){me._render_appbox();}else{me._render_web();}}});},_add_adtag:function(data){if(constants.IS_APPBOX&&closed_ad_appbox){return;}else if(!constants.IS_APPBOX&&closed_ad_web){return;}
var web_href=data['web_href'];if(data['web_href']){data['web_href']=urls.make_url(data['web_href'],{WYTAG:aid.WEIYUN_APP_WEB_LOGIN});}
if(data['appbox_text_href']){data['appbox_text_href']=urls.make_url(data['appbox_text_href'],{WYTAG:aid.WEIYUN_APP_APPBOX});}
if(data['appbox_img_href']){data['appbox_img_href']=urls.make_url(data['appbox_img_href'],{WYTAG:aid.WEIYUN_APP_APPBOX});}
this.listenTo(query_user,'load',function(){if(!constants.IS_APPBOX&&web_href){$('#_header_ad_link a').attr('href',urls.make_url(web_href,{WYTAG:aid.WEIYUN_APP_WEB_DISK}));}});},_render_web:function(){var me=this;if(!closed_ad_web){$('#_header_ad_link').show().click(function(evt){me._after_link_click(evt);}).find('a').attr('href',link_options['web_href']).text(link_options['web_text']);}},_render_appbox:function(){var me=this;if(!closed_ad_appbox){$('#_header_ad_link_'+default_link_type).show().click(function(evt){me._after_link_click(evt);}).find('a').text(link_options['appbox_'+default_link_type+'_text']).attr('href',link_options['appbox_'+default_link_type+'_href']);if(default_link_type==='img'){$('#_header_ad_link_'+default_link_type+' img').attr('src',link_options['appbox_'+default_link_type+'_src']).attr('alt',link_options['appbox_'+default_link_type+'_alt']);}}},_after_link_click:function(evt){if(constants.IS_APPBOX){user_log('header_ad_link_appbox');if((default_link_type==='text'||default_link_type==='img')&&show_phone_download){evt.preventDefault();this._show_phone_download_dialog();}}else{user_log('header_ad_link_web');}},_show_phone_download_dialog:function(){var _el_dialog=$('#phone_download_dialog');if(_el_dialog.length===0){_el_dialog=$(this._generate_phone_ad_markup()).appendTo($('body')).show();center.listen(_el_dialog);this._init_dialog_events();}else{$('#phone_download_dialog .register_form input.text').val('');$('#phone_download_dialog .register_form').show();$('#phone_download_dialog .register_success').hide();$('#phone_download_dialog .register_form p.error_des').hide();_el_dialog.show();}},_toggle_phone_download_dialog:function(mod_alias){if(mod_alias==='photo'){$('#phone_download_dialog').hide();}},_init_dialog_events:function(){var main=require('./main');this.listenTo(main,'activate_sub_module',this._toggle_phone_download_dialog);$('#phone_download_dialog').on('click','del, .register_success a.button',function(){$('#phone_download_dialog').hide();}).on('click','.register_form a.button',function(){var _num=$('#phone_download_dialog .register_form input.text').val(),_el_error=$('#phone_download_dialog .register_form p.error_des');if(!(/^1[358]\d{9}$/.test(_num))){_el_error.show();}else{_el_error.hide();$.get('http://www.weiyun.com/php/msgsend.php',{number:_num,flag:1},function(data){if(data.ret=='0'){$('#phone_download_dialog .register_form').hide();$('#phone_download_dialog .register_success').show();}else if(data.ret=='6'||data.ret=='7'){_el_error.html('发送速率过快，请稍后再发,您还可以通过右侧二维码的方式快速安装微云。').show();}else{_el_error.html('网络繁忙，暂不能发送短信，请稍后再试。建议您通过右侧二维码的方式快速安装微云。').show();}},'json');}}).on('click','.register_success a.tryagain',function(){$('#phone_download_dialog .register_form').show();$('#phone_download_dialog .register_success').hide();$('#phone_download_dialog .register_form p.error_des').hide();});},_generate_phone_ad_markup:function(){return['<div class="get_app_layer" id="phone_download_dialog" style="display:none;">','<del></del>','<h2>微云手机版</h2>','<div class="get_url_area">','<div class="register_area">','<div class="register_form" style="display: ;">','<h3>方法一：短信获取下载地址</h3>','<p class="des">请填写手机号，下载地址将发送到您的手机上。</p>','<input class="text" type="tel" placeholder="请输入手机号码">','<a class="button" href="javascript:void(0)">发送短信</a>','<p class="error_des" style="display: none;">您输入的电话号码有误，请重新输入。</p>','</div>','<div class="register_success" style="display: none;">','<h3>方法一：手机短信获取</h3>','<p class="des">您将收到一条包含微云下载地址的短信，点击短信中的地址即可开始下载。</p>','<a class="button" href="javascript:void(0)">完成</a>','&nbsp;&nbsp;&nbsp;&nbsp;<a class="tryagain" href="javascript:void(0)">再次发送短信</a><p></p>','</div>','<div class="get_apk">','<h3>方法二：下载安装包</h3>','<p class="des other">','<a href="'+link_options['android_appbox_url']+'">android版</a>','<a target="_blank" href="'+link_options['iphone_url']+'">iPhone版</a>','</p>','</div>','</div>','</div>','<div class="get_code_area">','<h3>方法三：二维码获取</h3>','<p class="des">使用手机上的二维码扫描软件拍摄以下二维码即可立即下载。</p>','<img src="http://imgcache.qq.com/vipstyle/nr/box/portal/demoImg/weiyunQR.png">','</div>','</div>'].join('');}};$.extend(ad_link,events);return ad_link;});define.pack("./first_tips",["lib","common","$","./tmpl"],function(require,exports,module){var lib=require('lib'),common=require('common'),$=require('$'),collections=lib.get('./collections'),console=lib.get('./console'),text=lib.get('./text'),events=lib.get('./events'),Module=common.get('./module'),query_user=common.get('./query_user'),tmpl=require('./tmpl'),undefined;var first_tips=new Module('first_tips',{render:function(){this.listenToOnce(query_user,'load',function(user){if(user.is_qqdisk_user()&&user.is_qqdisk_user_first_access()){this.show_qqdisk_tips();}
else if(user.is_favorites_user()&&user.is_fav_user_first_access()){this.show_fav_tips();}});},show_qqdisk_tips:function(){require.async('qd_migration',function(mod){var qd_migration=mod.get('./qd_migration');qd_migration.show();});},show_fav_tips:function(){require.async('net_fav_migration',function(mod){var net_fav_migration=mod.get('./net_fav_migration');net_fav_migration.show();});}});return first_tips;});define.pack("./g5_ad",["lib","common","$","./tmpl"],function(require,exports,module){var lib=require('lib'),common=require('common'),$=require('$'),collections=lib.get('./collections'),console=lib.get('./console'),text=lib.get('./text'),events=lib.get('./events'),store=lib.get('./store'),query_user=common.get('./query_user'),user_log=common.get('./user_log'),tmpl=require('./tmpl'),size_limit=7*Math.pow(1024,3),ad_closed_store_key='_g5_ad_closed',undefined;var g5_ad={render:function(){this.listenToOnce(query_user,'load',function(user){var closed_ad=!!store.get(query_user.get_uin_num()+ad_closed_store_key);if(user.get_total_space()<size_limit&&!closed_ad){var $el=$('#_header_5g_ad').show();$el.on('click','[data-action=click]',function(e){user_log('click_5g_ad');});$el.on('click','[data-action=X]',function(e){e.preventDefault();user_log('close_5g_ad');$el.remove();store.set(query_user.get_uin_num()+ad_closed_store_key,1);});}});}};$.extend(g5_ad,events);return g5_ad;});define.pack("./go_top",["lib","common","$","./tmpl","./ui"],function(require,exports,module){var lib=require('lib'),common=require('common'),$=require('$'),collections=lib.get('./collections'),console=lib.get('./console'),text=lib.get('./text'),events=lib.get('./events'),Module=common.get('./module'),widgets=common.get('./ui.widgets'),scroller=common.get('./ui.scroller'),global_event=common.get('./global.global_event'),click_tj=common.get('./configs.click_tj'),tmpl=require('./tmpl'),main_ui,_$win=$(window),_$el,_$box,_visible=false,undefined;var go_top=new Module('go_top',{render:function(){main_ui=require('./ui');_$box=main_ui.get_$body_box();this.listenTo(global_event,'window_scroll',function(){if(this._need_show()){this._show();}else{this._hide();}});this.listenTo(global_event,'window_resize',function(){if(this._need_show()){this._update_right();}});},_render_if:function(){if(!_$el){_$el=$(['<a href="#" class="box_mod_totop" style="display:none;" hidefocus="on" ',click_tj.make_tj_str('TO_TOP'),'></a>'].join('')).appendTo(document.body);_$el.on('click',function(e){e.preventDefault();scroller.top();});this._update_right();}},_show:function(){this._render_if();if(!_visible){_$el.stop(true,true).fadeIn();_visible=true;}},_hide:function(){if(_$el&&_visible){_$el.stop(true,true).fadeOut();}
_visible=false;},_update_right:function(){this._render_if();_$el.css('right',((_$win.width()-_$box.width())/2-_$el.outerWidth()-1)+'px');},_need_show:function(){return _$win.scrollTop()>_$win.height()/3;}});return go_top;});define.pack("./main",["lib","common","$","./tmpl","./access_check","./ui"],function(require,exports,module){var lib=require('lib'),common=require('common'),$=require('$'),collections=lib.get('./collections'),console=lib.get('./console'),events=lib.get('./events'),routers=lib.get('./routers'),Module=common.get('./module'),query_user=common.get('./query_user'),urls=common.get('./urls'),m_speed=common.get('./m_speed'),tmpl=require('./tmpl'),access_check=require('./access_check'),module_hash_key,default_module_name,sub_modules_map,async_sub_modules={},cur_mod_alias,undefined;var main=new Module('main',{ui:require('./ui'),set_default_module:function(mod_name){default_module_name=mod_name;return this;},set_module_hash_key:function(key){module_hash_key=key;return this;},set_async_modules_map:function(map){sub_modules_map=map;return this;},async_render_module:function(mod_alias,params){if(!(mod_alias in sub_modules_map)){mod_alias=default_module_name;}
cur_mod_alias=mod_alias;var me=this;if(async_sub_modules.hasOwnProperty(mod_alias)){var mod=async_sub_modules[mod_alias];me.activate_sub_module(mod,params);me.trigger('activate_sub_module',mod_alias);}
else{try{m_speed.start(mod_alias,'js_css');}
catch(e){}
require.async(mod_alias,function(module_dir){cur_mod_alias=mod_alias;try{m_speed.done(mod_alias,'js_css');}
catch(e){}
var main_mod=sub_modules_map[mod_alias];if(!module_dir||!module_dir.get){console.error('模块加载失败：',mod_alias,main_mod);return;}
var mod=module_dir.get(main_mod);async_sub_modules[mod_alias]=mod;me.activate_sub_module(mod,params,mod_alias);me.trigger('activate_sub_module',mod_alias);});}},activate_sub_module:function(cur_mod,params,mod_alias){for(var mod_alias in async_sub_modules){var async_sub_mod=async_sub_modules[mod_alias];if(async_sub_mod!==cur_mod){async_sub_mod.deactivate();}}
cur_mod.render(this.ui.get_$header_box(),this.ui.get_$body_box());cur_mod.activate(params);},get_cur_mod_alias:function(){return cur_mod_alias;}});main.once('render',function(){this.listenTo(routers,'init',function(){var default_mod=routers.get_param(module_hash_key)||default_module_name;this.async_render_module(default_mod);}).listenTo(routers,'add.'+module_hash_key,function(mod_name){this.async_render_module(mod_name);}).listenTo(routers,'change.'+module_hash_key,function(mod_name){this.async_render_module(mod_name);}).listenTo(routers,'remove.'+module_hash_key,function(){this.async_render_module(default_module_name);});routers.init();access_check.start();});return main;});define.pack("./space_info.space_info",["lib","common","$","./tmpl","./space_info.ui"],function(require,exports,module){var lib=require('lib'),common=require('common'),$=require('$'),collections=lib.get('./collections'),console=lib.get('./console'),text=lib.get('./text'),events=lib.get('./events'),Module=common.get('./module'),query_user=common.get('./query_user'),global_event=common.get('./global.global_event'),tmpl=require('./tmpl'),undefined;var space_info=new Module('main_space_info',{ui:require('./space_info.ui'),render:function(){this.listenTo(query_user,'load',function(user){this._refresh_by_user(user);});var user=query_user.get_cached_user();if(user){this.once('render',function(){this._refresh_by_user(user);});}},refresh:function(){var me=this;query_user.get(true,false,false,function(user){me._refresh_by_user(user);});},_refresh_by_user:function(user){this.trigger('load',user.get_used_space(),user.get_total_space());},add_used_space_size:function(size){this.ui.add_used_space_size(size);}});return space_info;});define.pack("./space_info.ui",["lib","common","$","./tmpl","./space_info.space_info"],function(require,exports,module){var lib=require('lib'),common=require('common'),constants=common.get('./constants'),$=require('$'),collections=lib.get('./collections'),console=lib.get('./console'),text=lib.get('./text'),events=lib.get('./events'),Module=common.get('./module'),File=common.get('./file.file_object'),tmpl=require('./tmpl'),space_info,undefined;var ui=new Module('main_space_info_ui',{_used_space:0,_total_space:0,render:function($to){space_info=require('./space_info.space_info');this._$el=$(tmpl.space_info());$($to).replaceWith(this._$el);this._$text=$('#_main_space_info_text');this._$bar=$('#_main_space_info_bar');this.listenTo(space_info,'load',function(used_space,total_space){this._used_space=used_space;this._total_space=total_space;this.trigger('space_size_changed');}).on('space_size_changed',function(){this._update_text();this._update_bar();});},add_used_space_size:function(size){this._used_space+=size;this.trigger('space_size_changed');},_update_text:function(){this._$text.text(text.format('{used_space}/{total_space}',{used_space:File.get_readability_size(this._used_space),total_space:File.get_readability_size(this._total_space)}));},_update_bar:function(){var percent=Math.floor(this._used_space/this._total_space*100);this._$bar.css('width',Math.min(percent,100)+'%').parent().toggleClass('full',percent>=90).attr('title',percent+'%');}});return ui;});define.pack("./ui",["webbase_css","lib","common","$","./tmpl","./main","./user_info","./space_info.space_info","./first_tips","./ad_link"],function(require,exports,module){require('webbase_css');var lib=require('lib'),common=require('common'),$=require('$'),console=lib.get('./console'),routers=lib.get('./routers'),constants=common.get('./constants'),global_event=common.get('./global.global_event'),Module=common.get('./module'),query_user=common.get('./query_user'),ret_msgs=common.get('./ret_msgs'),user_log=common.get('./user_log'),aid=common.get('./configs.aid'),urls=common.get('./urls'),tmpl=require('./tmpl'),is_visible=false,main,undefined;var ui=new Module('main_ui',{render:function(){main=require('./main');this._init_ui();this._init_header_fix();this._render_user_info();this._render_first_tips();this._render_ftn_dns_detect();this._init_log();this._render_ad_link();},_init_ui:function(){var $ui_root=this._$ui_root=$(tmpl.root()),body_class=constants.IS_APPBOX?'app-appbox':'web-app';$(document.body).addClass(body_class).append($ui_root);this._toggle_base_body(false);if(constants.IS_APPBOX){this._toggle_base_header(false);}
this.listenTo(query_user,'done',function(msg,ret){if(ret!==ret_msgs.INVALID_SESSION&&ret!==ret_msgs.INVALID_INDEP_PWD){is_visible=true;this._render_nav();this._toggle_base_header(true);this._toggle_base_body(true);if(!constants.IS_APPBOX){$('#_main_header_cnt .logo').attr('href',urls.make_url('/index.html',{WYTAG:aid.WEIYUN_APP_WEB_DISK}));}}});this.listenTo(main,'activate_sub_module',function(){this._hide_loading();});if(!constants.IS_APPBOX){this._fix_ie6_min_width();}},_init_header_fix:function(){this.listenTo(global_event,'page_header_height_changed',this._fix_header_height);},_fix_header_height:function(){var new_height=this.get_fixed_header_height();this._get_$header_placeholder().height(new_height);global_event.trigger('page_header_height_resize',new_height);},_render_user_info:function(){require('./user_info').render();this._render_space_info($('#_main_space_info'));},_render_space_info:function($to){if(constants.IS_APPBOX){this.listenTo(main,'activate_sub_module',function(mod_alias){if(mod_alias==='disk'){require('./space_info.space_info').render($to);}});}
else{require('./space_info.space_info').render($to);}},_init_log:function(){$('#_main_client_down').on('click',function(){user_log('HEADER_USER_FACE_DOWNLOAD_CLIENT');});$('#_main_feedback').on('click',function(){user_log('HEADER_USER_FACE_FEEDBACK');});},_toggle_base_header:function(flag){this.get_$header_banner().toggle(!!flag);},_toggle_base_body:function(flag){this.get_$body_box().toggle(!!flag);this.get_$header_box().toggle(!!flag);this._fix_header_height();},get_$header_cnt:function(){return $('#_main_header_cnt');},get_$header_banner:function(){return $('#_main_header_banner');},get_$header_box:function(){return $('#_main_header_box');},get_$body_box:function(){return $('#_main_box');},get_$ui_root:function(){return this._$ui_root;},get_$wrapper:function(){return this._$wrapper||(this._$wrapper=$('#_main_wrapper'));},is_visible:function(){return is_visible;},get_fixed_header_height:function(){return this._get_$fixed_header().height();},_get_$fixed_header:function(){return this._$fixed_header||(this._$fixed_header=$('#_main_fixed_header'));},_get_$header_placeholder:function(){return this._$header_placeholder||(this._$header_placeholder=$('#_main_header_placeholder'));},_get_$nav:function(){return this._$nav||(this._$nav=$('#_main_nav'));},_render_nav:function(){var $nav=this._get_$nav().show();$nav.on('click','li[data-mod]',function(e){e.preventDefault();var $el=$(this),mod_alias=$el.attr('data-mod');routers.go({m:mod_alias});}).on('click','a[data-refresh]',function(e){e.preventDefault();e.stopPropagation();var $el=$(this),mod_alias=$el.attr('data-refresh');if(mod_alias){global_event.trigger(mod_alias+'_refresh');}});var current_nav=function(mod_alias){if(constants.IS_APPBOX&&mod_alias==='recycle'){mod_alias='disk';}
$nav.find('[data-mod]').removeClass('current').filter('[data-mod="'+mod_alias+'"]').addClass('current');};this.listenTo(main,'activate_sub_module',function(mod_alias){current_nav(mod_alias);});var cur_mod_alias=main.get_cur_mod_alias();if(cur_mod_alias){current_nav(cur_mod_alias);}
if(!constants.IS_APPBOX){var $win=$(window),fix_header_height=this.get_$header_banner().outerHeight(),fix_size=function(_,win_height){var nav_height=win_height-fix_header_height-2;$nav.height(nav_height);};this.listenTo(global_event,'window_resize',fix_size);fix_size(0,$win.height());}},_render_first_tips:function(){require('./first_tips').render();},_render_ftn_dns_detect:function(){setTimeout(function(){require.async('ftn_dns_detect');},10000);},_hide_loading:function(){$('#loading-text').remove();$('#loading-icon').remove();$('html').css('backgroundColor','');},_render_ad_link:function(){require('./ad_link').render();},_fix_ie6_min_width:function(){if($.browser.msie&&$.browser.version<7){var root_min_width=930,$root=this.get_$ui_root(),$win=$(window),fix_size=function(win_width){if(win_width<root_min_width){$root.width(root_min_width);}else{$root.css('width','');}};this.listenTo(global_event,'window_resize',fix_size);fix_size($win.width());}}});if(constants.IS_WEBKIT_APPBOX){ui.once('render',function(){setTimeout(function(){require.async('webkit_download_manager');},200);});}
return ui;});define.pack("./user_info",["lib","common","$"],function(require,exports,module){var lib=require('lib'),common=require('common'),$=require('$'),text=lib.get('./text'),events=lib.get('./events'),query_user=common.get('./query_user'),constants=common.get('./constants'),page_event=common.get('./global.global_event').namespace('page'),urls=common.get('./urls'),widgets=common.get('./ui.widgets'),user_log=common.get('./user_log'),win=window,last_has_pwd,last_user_uin,face_rendered=false,face_menu_visible=false,undefined;var user_info={render:function(){this._render_pwd_locker();this._render_logout();var cur_user=query_user.get_cached_user();if(cur_user){this._render_face(cur_user);this.set_nickname(cur_user.get_nickname());}
this.listenTo(query_user,'load',function(user){if(!last_user_uin&&!face_rendered){last_user_uin=user.get_uin();}else if(last_user_uin!==user.get_uin()){face_rendered=false;}
this._render_face(user);this.set_nickname(user.get_nickname());if(last_has_pwd!==user.has_pwd()){this.set_pwd_locker(user.has_pwd());}});},set_pwd_locker:function(locked){var $locker=this._get_$locker();$locker.find('span').toggle(!locked);},set_nickname:function(nickname){if($.browser.msie&$.browser.version<7){nickname=text.smart_sub(nickname,constants.IS_APPBOX?6:7);}
$('#_main_nick_name').text(nickname);},_render_face:function(user){if(!constants.IS_APPBOX&&face_rendered)
return;var $face=$('#_main_face'),$face_menu=$('#_main_face_menu'),$face_img=$face.find('img'),$avatar=$face.find('span.user-avatar');var timeId=0,show=function(){clearTimeout(timeId);if(!face_menu_visible){$face_menu.stop(true,true).show();if(constants.IS_APPBOX){$face.addClass('user-info-hover');}else{$avatar.addClass('user-avatar-hover');}
face_menu_visible=true;user_log('HEADER_USER_FACE_HOVER');}},hide=function(){timeId=setTimeout(function(){if(face_menu_visible){$face_menu.hide();if(constants.IS_APPBOX){$face.removeClass('user-info-hover');}else{$avatar.removeClass('user-avatar-hover');}
face_menu_visible=false;}},300);};$face.on('click',show).hover(show,hide);$face_menu.hover(show,hide);$face.show();this._get_face_by_uin(user.get_uin()).done(function(url){$face_img.attr('src',url);});face_rendered=true;},_render_pwd_locker:function(){var me=this;page_event.on('set_indep_pwd',function(){me.set_pwd_locker(true);}).on('unset_indep_pwd',function(){me.set_pwd_locker(false);});me._get_$locker().on('click',function(e){e.preventDefault();if(query_user.get_cached_user()){require.async('indep_setting',function(indep_setting){var indep_setting_mod=indep_setting.get('./indep_setting');indep_setting_mod.show();});}});},_render_logout:function(){var me=this;$('#_main_logout').on('click',function(e){e.preventDefault();var msg=page_event.trigger('before_unload');if(msg){widgets.confirm('确认',msg,'',function(){page_event.trigger('confirm_unload');me._logout();});}else{me._logout();}});},_logout:function(){query_user.destroy();window.location.href='http://www.weiyun.com/disk/index.html';},_get_$locker:function(){return $('#_main_pwd_locker');},_get_face_by_uin:function(uin){var def=$.Deferred();$.ajax({url:urls.make_url('http://ptlogin2.weiyun.com/getface',{appid:527020901,imgtype:3,encrytype:0,devtype:0,keytpye:0,uin:uin,r:Math.random()}),dataType:'jsonp',jsonp:false});win.pt={setHeader:function(json){for(var key in json){if(json[key]){def.resolve(json[key]);break;}}
if('resolved'!==def.state()){def.reject();}
win.pt=null;try{delete window.pt;}catch(e){}}};return def;}};$.extend(user_info,events);return user_info;});define.pack("./tmpl",[],function(require,exports,module){var tmpl={'appbox_header':function(data){var __p=[],_p=function(s){__p.push(s)};__p.push('    ');var common=require('common'),aid=common.get('./configs.aid'),click_tj=common.get('./configs.click_tj'),urls=common.get('./urls');__p.push('    <div id="_main_header_cnt" class="nav-mini">\r\n\
        <div class="nav-pos">');_p(tmpl.ad_link_appbox());__p.push('            <!--appbox的导航在顶部-->');_p(this.nav());__p.push('            ');_p(this.face_and_menu_appbox());__p.push('        </div>\r\n\
    </div>');return __p.join("");},'web_header':function(data){var __p=[],_p=function(s){__p.push(s)};__p.push('    ');var common=require('common'),constants=common.get('./constants'),aid=common.get('./configs.aid'),click_tj=common.get('./configs.click_tj'),urls=common.get('./urls');__p.push('    <div id="_main_header_cnt" class="header-cnt">\r\n\
        <h1><a class="logo" href="');_p(urls.make_url('/index.html',{WYTAG:aid.WEIYUN_APP_WEB_LOGIN}));__p.push('" ');_p(constants.IS_WRAPPED?'target="_blank"':'');__p.push('><span>微云</span></a></h1>');_p(this.face_and_menu_web());__p.push('    </div>');return __p.join("");},'root':function(data){var __p=[],_p=function(s){__p.push(s)};__p.push('    ');var common=require('common'),constants=common.get('./constants');__p.push('    <div class="ui-root">\r\n\
        <div id="_main_fixed_header" class="header-fixed">\r\n\
\r\n\
            <!-- 头部 -->\r\n\
            <div id="_main_header_banner" class="header">');_p(constants.IS_APPBOX?this.appbox_header():this.web_header());__p.push('            </div>\r\n\
\r\n\
            <div id="_main_header_box"></div>\r\n\
\r\n\
            <!--web的导航在左侧-->');if(!constants.IS_APPBOX){__p.push('                ');_p(this.nav());__p.push('            ');}__p.push('        </div>\r\n\
\r\n\
        <!-- 为实现头部静止而存在 -->\r\n\
        <div id="_main_header_placeholder" class="header-placeholder"></div>\r\n\
\r\n\
        <div id="_main_wrapper" class="wrapper">\r\n\
            <div id="_main_box">\r\n\
\r\n\
            </div>\r\n\
        </div>\r\n\
    </div>');return __p.join("");},'face_and_menu_web':function(data){var __p=[],_p=function(s){__p.push(s)};__p.push('    ');var common=require('common'),constants=common.get('./constants'),aid=common.get('./configs.aid'),click_tj=common.get('./configs.click_tj'),urls=common.get('./urls');__p.push('    <!-- 头像 -->\r\n\
    <div id="_main_face" data-no-selection class="header-right" style="display:none;">\r\n\
        <span class="user-info">\r\n\
            <span class="user-avatar">\r\n\
                <img src="http://imgcache.qq.com/ptlogin/v4/style/0/images/1.gif"/>\r\n\
                <i class="ui-arr"></i>\r\n\
            </span>\r\n\
        </span>\r\n\
    </div>');_p(tmpl.ad_link_web());__p.push('    <!-- 头像下方的菜单 -->\r\n\
    <div id="_main_face_menu"  data-no-selection class="ui-pop ui-pop-user" style="display:none;">\r\n\
        <div class="ui-pop-head">\r\n\
            <span id="_main_nick_name" class="user-nick">...</span>\r\n\
            <div id="_main_space_info"></div>\r\n\
        </div>\r\n\
\r\n\
        <ul class="ui-menu">\r\n\
            <li><a id="_main_pwd_locker" ');_p(click_tj.make_tj_str('INDEP_PWD'));__p.push(' href="javascript:void(0)"><i class="icon-pwd"></i>独立密码<span class="menu-text">（未开启）</span></a></li>\r\n\
            <li><a id="_main_client_down" href="');_p(urls.make_url('http://www.weiyun.com/download.html',{WYTAG:aid.WEIYUN_APP_WEB_DISK}));__p.push('" target="_blank"><i class="icon-dwn"></i>下载客户端</a></li>\r\n\
            <li><a id="_main_feedback" href="');_p(urls.make_url('http://support.qq.com/write.shtml',{fid:943,SSTAG:'web_disk',WYTAG:aid.WEIYUN_APP_WEB_DISK}));__p.push('" target="_blank">\r\n\
                <i class="icon-fedbk"></i>反馈\r\n\
            </a></li>');if(!constants.IS_WRAPPED){__p.push('                <li><a id="_main_logout" ');_p(click_tj.make_tj_str('LOGIN_OUT'));__p.push(' href="#"><i class="icon-exit"></i>退出</a></li>');}__p.push('        </ul>\r\n\
        <i class="ui-arr"></i>\r\n\
        <i class="ui-arr ui-tarr"></i>\r\n\
    </div>');return __p.join("");},'face_and_menu_appbox':function(data){var __p=[],_p=function(s){__p.push(s)};__p.push('    ');var common=require('common'),aid=common.get('./configs.aid'),click_tj=common.get('./configs.click_tj'),urls=common.get('./urls'),constants=common.get('./constants');__p.push('    <!-- 头像 -->\r\n\
    <div id="_main_face" data-no-selection class="header-right" style="display:none;">\r\n\
        <span class="user-info">\r\n\
            <span class="user-avatar">\r\n\
                <span id="_main_nick_name" class="user-nickname">...</span>\r\n\
                <i class="ui-arr"></i>\r\n\
            </span>\r\n\
        </span>\r\n\
        <!-- 头像下方的菜单 -->\r\n\
        <div id="_main_face_menu"  data-no-selection class="ui-pop ui-pop-user" style="display:none;">\r\n\
            <div class="ui-pop-head">\r\n\
                <div id="_main_space_info"></div>\r\n\
            </div>\r\n\
            <ul class="ui-menu">\r\n\
                <li><a id="_main_pwd_locker" ');_p(click_tj.make_tj_str('INDEP_PWD'));__p.push(' href="javascript:void(0)"><i class="icon-pwd"></i>独立密码<span class="menu-text">（未开启）</span></a></li>\r\n\
                <li><a id="_main_client_down" href="');_p(urls.make_url('http://www.weiyun.com/download.html',{WYTAG:aid.WEIYUN_APP_APPBOX}));__p.push('" target="_blank"><i class="icon-dwn"></i>下载客户端</a></li>\r\n\
                <li><a href="');_p(urls.make_url('http://support.qq.com/write.shtml',{fid:943,SSTAG:'appbox_disk',WYTAG:aid.WEIYUN_APP_APPBOX}));__p.push('" target="_blank">\r\n\
                    <i class="icon-fedbk"></i>反馈\r\n\
                </a></li>\r\n\
            </ul>\r\n\
        </div>\r\n\
    </div>');return __p.join("");},'nav':function(data){var __p=[],_p=function(s){__p.push(s)};__p.push('    ');var common=require('common'),click_tj=common.get('./configs.click_tj'),constants=common.get('./constants');__p.push('    ');if(constants.IS_APPBOX){__p.push('        <ul id="_main_nav" style="display:none;" class="nav-tab clear">\r\n\
            <li data-mod="disk" class="nav-tab-item"><a href="#" ');_p(click_tj.make_tj_str('NAV_DISK'));__p.push('>微云网盘</a></li>\r\n\
            <li data-mod="photo" class="nav-tab-item"><a href="#" ');_p(click_tj.make_tj_str('NAV_PHOTO'));__p.push('>微云相册</a></li>\r\n\
        </ul>');}else{__p.push('        <div id="_main_nav" class="ui-vnav" style="display:none;">\r\n\
            <ul class="ui-nav-inner">\r\n\
\r\n\
                <li data-mod="disk" class="ui-item">\r\n\
                    <a href="#" ');_p(click_tj.make_tj_str('NAV_DISK'));__p.push('>\r\n\
                        <span class="ui-text">网盘</span>\r\n\
                        <i class="ui-bg nav-disk"></i>\r\n\
                    </a>\r\n\
                </li>\r\n\
\r\n\
                <li data-mod="photo" class="ui-item">\r\n\
                    <a href="#" ');_p(click_tj.make_tj_str('NAV_PHOTO'));__p.push('>\r\n\
                        <span class="ui-text">相册</span>\r\n\
                        <i class="ui-bg nav-photo"></i>\r\n\
                    </a>\r\n\
                </li>\r\n\
\r\n\
                <li data-mod="recent" class="ui-item">\r\n\
                    <a href="#" ');_p(click_tj.make_tj_str('NAV_RECENT'));__p.push('>\r\n\
                        <span class="ui-text">最近</span>\r\n\
                        <i class="ui-bg nav-recent"></i>\r\n\
                    </a>\r\n\
                    <a data-refresh="recent" class="nav-refresh" href="javascript:void(0)" title="刷新" ');_p(click_tj.make_tj_str('RECENT_REFRESH_BTN'));__p.push('><span>刷新</span></a>\r\n\
                </li>\r\n\
\r\n\
                <!--分割线-->\r\n\
                <li class="ui-bar"><b class="ui-bd"></b></li>\r\n\
\r\n\
                <li data-mod="recycle" class="ui-item">\r\n\
                    <a href="#" ');_p(click_tj.make_tj_str('NAV_RECYCLE'));__p.push('>\r\n\
                        <span class="ui-text">回收站</span>\r\n\
                        <i class="ui-bg nav-recycle"></i>\r\n\
                    </a>\r\n\
                </li>\r\n\
            </ul>\r\n\
            <!-- 阴影 -->\r\n\
            <b class="ui-shd"></b>\r\n\
        </div>');}__p.push('');return __p.join("");},'ad_link_web':function(data){var __p=[],_p=function(s){__p.push(s)};with(data||{}){__p.push('    <div id="_header_ad_link" class="header-ad-text" style="display:none;"><i class="ico-notice"></i><a href="#" target="_blank"></a></div>');}
return __p.join("");},'ad_link_appbox':function(data){var __p=[],_p=function(s){__p.push(s)};with(data||{}){__p.push('    <div id="_header_ad_link_img" style="display:none;"><a  class="header-ad" href="#"  target="_blank"><img src=""/></a></div>\r\n\
    <div id="_header_ad_link_text" class="header-ad-text" style="display:none;"><i class="ico-notice"></i><a href="#" target="_blank"></a></div>');}
return __p.join("");},'space_info':function(data){var __p=[],_p=function(s){__p.push(s)};__p.push('    <div class="ui-text quota-info">\r\n\
        <label>已使用：</label>\r\n\
        <span id="_main_space_info_text">0G/0G</span>\r\n\
    </div>\r\n\
    <div class="ui-quota">\r\n\
        <div id="_main_space_info_bar" class="ui-quota-bar" style="width: 0%;"></div>\r\n\
    </div>');return __p.join("");}};return tmpl;});/*  |xGv00|690f3a7734cd1f9f8994a6826efecd9d */